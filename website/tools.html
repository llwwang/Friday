<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®ç”¨å·¥å…· | Friday</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
        }
        
        /* å¯¼èˆªæ  */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(26, 26, 46, 0.95);
            border-bottom: 1px solid rgba(0, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            z-index: 1000;
            padding: 0 20px;
        }
        
        .navbar-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 60px;
        }
        
        .navbar-brand {
            font-family: 'Courier New', monospace;
            font-size: 20px;
            font-weight: bold;
            color: #00ffff;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .navbar-brand::before {
            content: 'â—ˆ';
            color: #ff00ff;
        }
        
        .navbar-nav {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            font-size: 14px;
            border-radius: 6px;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }
        
        .nav-link:hover {
            background: rgba(0, 255, 255, 0.1);
            color: #00ffff;
            border-color: rgba(0, 255, 255, 0.3);
        }
        
        .nav-link.active {
            background: rgba(0, 255, 255, 0.15);
            color: #00ffff;
            border-color: rgba(0, 255, 255, 0.5);
        }
        
        /* ä¸»å†…å®¹ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 80px 20px 20px;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(45deg, #00ffff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* å·¥å…·å¡ç‰‡ç½‘æ ¼ */
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }
        
        /* å·¥å…·å¡ç‰‡ */
        .tool-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
        }
        
        .tool-card h2 {
            font-size: 1.3em;
            margin-bottom: 20px;
            color: #00ffff;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .tool-card h2::before {
            content: 'â–¸';
            color: #ff00ff;
        }
        
        /* IPæ˜¾ç¤ºåŒºåŸŸ */
        .ip-display {
            background: rgba(0, 255, 255, 0.05);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin-bottom: 15px;
        }
        
        .ip-label {
            font-size: 12px;
            color: #888;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .ip-value {
            font-size: 32px;
            font-weight: bold;
            color: #00ffff;
            font-family: 'Courier New', monospace;
            margin-bottom: 10px;
        }
        
        .ip-location {
            font-size: 14px;
            color: #888;
        }
        
        /* è¾“å…¥æ¡† */
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            font-size: 12px;
            color: #888;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #fff;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            transition: border-color 0.3s;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #00ffff;
        }
        
        .input-group input::placeholder {
            color: #666;
        }
        
        /* æŒ‰é’® */
        .btn {
            width: 100%;
            padding: 12px 20px;
            background: linear-gradient(135deg, #00ffff, #00cccc);
            border: none;
            border-radius: 8px;
            color: #000;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 255, 255, 0.3);
        }
        
        /* ç»“æœå±•ç¤º */
        .result-box {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }
        
        .result-box.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .result-label {
            color: #888;
            font-size: 13px;
        }
        
        .result-value {
            color: #00ffff;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
        
        /* é”™è¯¯æç¤º */
        .error-msg {
            color: #ff4d4f;
            font-size: 12px;
            margin-top: 10px;
            display: none;
        }
        
        .error-msg.show {
            display: block;
        }
        
        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .tools-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="navbar-content">
            <a href="/" class="navbar-brand">Friday</a>
            <div class="navbar-nav">
                <a href="/" class="nav-link">ğŸ  é¦–é¡µ</a>
                <a href="/stats.html" class="nav-link">ğŸ“Š è®¿é—®ç»Ÿè®¡</a>
                <a href="/stock.html" class="nav-link">ğŸ“ˆ è‚¡ç¥¨ç›‘æ§</a>
                <a href="/tools.html" class="nav-link active">ğŸ› ï¸ å®ç”¨å·¥å…·</a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <h1>ğŸ› ï¸ å®ç”¨å·¥å…·</h1>
        
        <div class="tools-grid">
            <!-- å·¥å…·1: å½“å‰IPæŸ¥è¯¢ -->
            <div class="tool-card">
                <h2>å½“å‰IPæŸ¥è¯¢</h2>
                <div class="ip-display">
                    <div class="ip-label">æ‚¨çš„IPåœ°å€</div>
                    <div class="ip-value" id="currentIP">åŠ è½½ä¸­...</div>
                    <div class="ip-location" id="ipLocation">--</div>
                </div>
                <button class="btn" onclick="refreshIP()">ğŸ”„ åˆ·æ–°IPä¿¡æ¯</button>
            </div>
            
            <!-- å·¥å…·2: IPæ®µè®¡ç®—å™¨ -->
            <div class="tool-card">
                <h2>IPæ®µè®¡ç®—å™¨</h2>
                <div class="input-group">
                    <label>CIDRæ ¼å¼ (å¦‚: 192.168.1.0/24)</label>
                    <input type="text" id="cidrInput" placeholder="è¾“å…¥IPæ®µï¼Œä¾‹å¦‚: 192.168.1.0/24">
                </div>
                <button class="btn" onclick="calculateIPRange()">ğŸ” è®¡ç®—IPèŒƒå›´</button>
                <div class="error-msg" id="errorMsg">è¯·è¾“å…¥æœ‰æ•ˆçš„CIDRæ ¼å¼</div>
                
                <div class="result-box" id="resultBox">
                    <div class="result-item">
                        <span class="result-label">ç½‘ç»œåœ°å€</span>
                        <span class="result-value" id="networkAddr">--</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">å­ç½‘æ©ç </span>
                        <span class="result-value" id="subnetMask">--</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">å¯ç”¨IPèŒƒå›´</span>
                        <span class="result-value" id="ipRange">--</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">å¯ç”¨IPæ•°é‡</span>
                        <span class="result-value" id="ipCount">--</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">å¹¿æ’­åœ°å€</span>
                        <span class="result-value" id="broadcastAddr">--</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // è·å–å½“å‰IP
        async function getCurrentIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                console.error('Error getting IP:', error);
                return 'è·å–å¤±è´¥';
            }
        }
        
        // è·å–IPåœ°ç†ä½ç½®
        async function getIPLocation(ip) {
            try {
                const response = await fetch(`https://ipapi.co/${ip}/json/`);
                const data = await response.json();
                if (data.error) {
                    return null;
                }
                return {
                    city: data.city,
                    region: data.region,
                    country: data.country_name,
                    org: data.org
                };
            } catch (error) {
                console.error('Error getting location:', error);
                return null;
            }
        }
        
        // åˆ·æ–°IPä¿¡æ¯
        async function refreshIP() {
            document.getElementById('currentIP').textContent = 'åŠ è½½ä¸­...';
            document.getElementById('ipLocation').textContent = '--';
            
            const ip = await getCurrentIP();
            document.getElementById('currentIP').textContent = ip;
            
            if (ip !== 'è·å–å¤±è´¥') {
                const location = await getIPLocation(ip);
                if (location) {
                    const locationStr = [location.country, location.region, location.city]
                        .filter(Boolean)
                        .join(' ');
                    const orgStr = location.org ? ` (${location.org})` : '';
                    document.getElementById('ipLocation').textContent = locationStr + orgStr;
                } else {
                    document.getElementById('ipLocation').textContent = 'ä½ç½®ä¿¡æ¯è·å–å¤±è´¥';
                }
            }
        }
        
        // IPæ®µè®¡ç®—å™¨
        function calculateIPRange() {
            const input = document.getElementById('cidrInput').value.trim();
            const errorMsg = document.getElementById('errorMsg');
            const resultBox = document.getElementById('resultBox');
            
            // éªŒè¯CIDRæ ¼å¼
            const cidrRegex = /^(\d{1,3}\.){3}\d{1,3}\/\d{1,2}$/;
            if (!cidrRegex.test(input)) {
                errorMsg.classList.add('show');
                resultBox.classList.remove('show');
                return;
            }
            
            errorMsg.classList.remove('show');
            
            try {
                const [ipPart, maskPart] = input.split('/');
                const mask = parseInt(maskPart);
                
                if (mask < 0 || mask > 32) {
                    throw new Error('Invalid mask');
                }
                
                // å°†IPè½¬æ¢ä¸ºæ•°å­—
                const ipParts = ipPart.split('.').map(Number);
                const ipNum = (ipParts[0] << 24) + (ipParts[1] << 16) + 
                             (ipParts[2] << 8) + ipParts[3];
                
                // è®¡ç®—æ©ç 
                const maskNum = mask === 0 ? 0 : (-1 << (32 - mask)) >>> 0;
                
                // ç½‘ç»œåœ°å€
                const networkNum = (ipNum & maskNum) >>> 0;
                
                // å¹¿æ’­åœ°å€
                const broadcastNum = (networkNum | (~maskNum >>> 0)) >>> 0;
                
                // ç¬¬ä¸€ä¸ªå¯ç”¨IP
                const firstIP = networkNum + 1;
                
                // æœ€åä¸€ä¸ªå¯ç”¨IP
                const lastIP = broadcastNum - 1;
                
                // å¯ç”¨IPæ•°é‡
                const count = mask === 31 ? 2 : (mask === 32 ? 1 : lastIP - firstIP + 1);
                
                // è½¬æ¢å›IPæ ¼å¼
                const toIP = (num) => {
                    return [(num >>> 24) & 255, (num >>> 16) & 255, 
                           (num >>> 8) & 255, num & 255].join('.');
                };
                
                // æ©ç IP
                const maskIP = toIP(maskNum);
                
                // æ˜¾ç¤ºç»“æœ
                document.getElementById('networkAddr').textContent = toIP(networkNum);
                document.getElementById('subnetMask').textContent = maskIP;
                document.getElementById('ipRange').textContent = 
                    mask === 32 ? toIP(networkNum) : `${toIP(firstIP)} - ${toIP(lastIP)}`;
                document.getElementById('ipCount').textContent = count.toLocaleString();
                document.getElementById('broadcastAddr').textContent = toIP(broadcastNum);
                
                resultBox.classList.add('show');
                
            } catch (error) {
                console.error('Calculation error:', error);
                errorMsg.textContent = 'è®¡ç®—é”™è¯¯ï¼Œè¯·æ£€æŸ¥è¾“å…¥æ ¼å¼';
                errorMsg.classList.add('show');
                resultBox.classList.remove('show');
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è·å–IP
        refreshIP();
        
        // è®°å½•è®¿é—®
        fetch('/api/visit', { 
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ page: window.location.pathname })
        }).catch(() => {});
    </script>
</body>
</html>