<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‚¡ç¥¨çœ‹æ¿ | Friday</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
        }
        
        /* å¯¼èˆªæ  */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(26, 26, 46, 0.95);
            border-bottom: 1px solid rgba(0, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            z-index: 1000;
            padding: 0 20px;
        }
        
        .navbar-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 60px;
        }
        
        .navbar-brand {
            font-family: 'Courier New', monospace;
            font-size: 20px;
            font-weight: bold;
            color: #00ffff;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .navbar-brand::before {
            content: 'â—ˆ';
            color: #ff00ff;
        }
        
        .navbar-nav {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .nav-item {
            position: relative;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            font-size: 14px;
            border-radius: 6px;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }
        
        .nav-link:hover {
            background: rgba(0, 255, 255, 0.1);
            color: #00ffff;
            border-color: rgba(0, 255, 255, 0.3);
        }
        
        .nav-link.active {
            background: rgba(0, 255, 255, 0.15);
            color: #00ffff;
            border-color: rgba(0, 255, 255, 0.5);
        }
        
        .nav-icon {
            font-size: 16px;
        }
        
        /* ä¸»å†…å®¹åŒº */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 80px 20px 20px;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(45deg, #00ffff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* å¸‚åœºçŠ¶æ€ */
        .market-status {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .market-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }
        
        .market-badge.hk {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid #00ffff;
            color: #00ffff;
        }
        
        .market-badge.us {
            background: rgba(255, 0, 255, 0.1);
            border: 1px solid #ff00ff;
            color: #ff00ff;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #00ff00;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* è‚¡ç¥¨å¡ç‰‡ç½‘æ ¼ */
        .stock-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        /* è‚¡ç¥¨å¡ç‰‡ */
        .stock-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            transition: transform 0.3s, border-color 0.3s;
            cursor: pointer;
        }
        
        .stock-card:hover {
            transform: translateY(-5px);
            border-color: rgba(0, 255, 255, 0.3);
        }
        
        .stock-card.up {
            border-left: 4px solid #ff4d4f;
        }
        
        .stock-card.down {
            border-left: 4px solid #52c41a;
        }
        
        .stock-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }
        
        .stock-info h3 {
            font-size: 18px;
            margin-bottom: 5px;
            color: #fff;
        }
        
        .stock-code {
            font-size: 12px;
            color: #888;
            font-family: 'Courier New', monospace;
        }
        
        .stock-price {
            text-align: right;
        }
        
        .price {
            font-size: 28px;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }
        
        .price.up { color: #ff4d4f; }
        .price.down { color: #52c41a; }
        
        .change {
            font-size: 14px;
            margin-top: 5px;
        }
        
        .change.up { color: #ff4d4f; }
        .change.down { color: #52c41a; }
        
        /* è¡Œæƒ…æ•°æ® */
        .stock-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .detail-item {
            text-align: center;
        }
        
        .detail-label {
            font-size: 11px;
            color: #888;
            margin-bottom: 3px;
        }
        
        .detail-value {
            font-size: 14px;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }
        
        /* æ›´æ–°æ—¶é—´ */
        .update-time {
            text-align: center;
            color: #666;
            font-size: 12px;
            margin-top: 20px;
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading {
            text-align: center;
            padding: 50px;
            color: #888;
        }
        
        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #00ffff;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* é”™è¯¯æç¤º */
        .error {
            text-align: center;
            padding: 50px;
            color: #ff4d4f;
        }
        
        /* è¿·ä½ å›¾è¡¨å ä½ */
        .mini-chart {
            height: 60px;
            margin-top: 15px;
            background: rgba(0, 255, 255, 0.05);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 12px;
        }
        
        /* åˆ†ç»„æ ‡é¢˜ */
        .stock-section {
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 20px;
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 8px;
            display: inline-block;
        }
        
        .section-title.cn {
            background: rgba(255, 100, 0, 0.1);
            border-left: 4px solid #ff6400;
            color: #ff6400;
        }
        
        .section-title.hk {
            background: rgba(0, 255, 255, 0.1);
            border-left: 4px solid #00ffff;
            color: #00ffff;
        }
        
        .section-title.us {
            background: rgba(255, 0, 255, 0.1);
            border-left: 4px solid #ff00ff;
            color: #ff00ff;
        }
        
        /* Sparkline chart */
        .sparkline {
            height: 50px;
            margin-top: 10px;
        }
        
        .sparkline svg {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="navbar-content">
            <a href="/" class="navbar-brand">Friday</a>
            <div class="navbar-nav">
                <div class="nav-item">
                    <a href="/" class="nav-link">
                        <span class="nav-icon">ğŸ </span>
                        <span>é¦–é¡µ</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="/stats.html" class="nav-link">
                        <span class="nav-icon">ğŸ“Š</span>
                        <span>è®¿é—®ç»Ÿè®¡</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="/stock.html" class="nav-link active">
                        <span class="nav-icon">ğŸ“ˆ</span>
                        <span>è‚¡ç¥¨ç›‘æ§</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="/tools.html" class="nav-link">
                        <span class="nav-icon">ğŸ› ï¸</span>
                        <span>å®ç”¨å·¥å…·</span>
                    </a>
                </div>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <h1>ğŸ“ˆ è‚¡ç¥¨çœ‹æ¿</h1>
        
        <!-- å¸‚åœºçŠ¶æ€ -->
        <div class="market-status">
            <div class="market-badge hk">
                <span class="status-dot"></span>
                <span>æ¸¯è‚¡äº¤æ˜“ä¸­</span>
            </div>
            <div class="market-badge us">
                <span class="status-dot"></span>
                <span>ç¾è‚¡äº¤æ˜“ä¸­</span>
            </div>
        </div>
        
        <!-- è‚¡ç¥¨åˆ—è¡¨ -->
        <div id="stockList" class="stock-grid">
            <div class="loading">æ­£åœ¨åŠ è½½è‚¡ç¥¨æ•°æ®...</div>
        </div>
        
        <!-- æ›´æ–°æ—¶é—´ -->
        <div class="update-time">
            æ•°æ®æ›´æ–°æ—¶é—´: <span id="updateTime">--</span>
        </div>
    </div>
    
    <script>
        // è‚¡ç¥¨é…ç½®
        const stocks = [
            // Aè‚¡
            { code: '600519', name: 'è´µå·èŒ…å°', market: 'cn', symbol: '600519', exchange: 'sh' },
            { code: '300750', name: 'å®å¾·æ—¶ä»£', market: 'cn', symbol: '300750', exchange: 'sz' },
            { code: '002594', name: 'æ¯”äºšè¿ª', market: 'cn', symbol: '002594', exchange: 'sz' },
            { code: '601318', name: 'ä¸­å›½å¹³å®‰', market: 'cn', symbol: '601318', exchange: 'sh' },
            { code: '000858', name: 'äº”ç²®æ¶²', market: 'cn', symbol: '000858', exchange: 'sz' },
            { code: '600036', name: 'æ‹›å•†é“¶è¡Œ', market: 'cn', symbol: '600036', exchange: 'sh' },
            // æ¸¯è‚¡
            { code: '00700', name: 'è…¾è®¯æ§è‚¡', market: 'hk', symbol: '00700.HK' },
            { code: '03690', name: 'ç¾å›¢', market: 'hk', symbol: '03690.HK' },
            { code: '09988', name: 'é˜¿é‡Œå·´å·´', market: 'hk', symbol: '09988.HK' },
            { code: '01810', name: 'å°ç±³é›†å›¢', market: 'hk', symbol: '01810.HK' },
            // ç¾è‚¡
            { code: 'AAPL', name: 'è‹¹æœ', market: 'us', symbol: 'AAPL' },
            { code: 'TSLA', name: 'ç‰¹æ–¯æ‹‰', market: 'us', symbol: 'TSLA' },
            { code: 'NVDA', name: 'è‹±ä¼Ÿè¾¾', market: 'us', symbol: 'NVDA' },
            { code: 'MSFT', name: 'å¾®è½¯', market: 'us', symbol: 'MSFT' },
            { code: 'GOOGL', name: 'è°·æ­Œ', market: 'us', symbol: 'GOOGL' },
            { code: 'BABA', name: 'é˜¿é‡Œå·´å·´', market: 'us', symbol: 'BABA' }
        ];
        
        // è·å–è…¾è®¯è´¢ç»è‚¡ç¥¨æ•°æ®ï¼ˆæ”¯æŒè·¨åŸŸï¼‰
        async function fetchStockData(stock) {
            try {
                let url;
                if (stock.market === 'hk') {
                    // æ¸¯è‚¡: hkCODE
                    url = `https://qt.gtimg.cn/q=hk${stock.code}`;
                } else if (stock.market === 'cn') {
                    // Aè‚¡: shCODE æˆ– szCODE
                    url = `https://qt.gtimg.cn/q=${stock.exchange}${stock.code}`;
                } else {
                    // ç¾è‚¡: usCODE
                    url = `https://qt.gtimg.cn/q=us${stock.code}`;
                }
                
                // ä½¿ç”¨æ–‡æœ¬æ ¼å¼è¿”å›
                const response = await fetch(url);
                const text = await response.text();
                
                // è§£æè…¾è®¯è´¢ç»æ•°æ®æ ¼å¼: v_hk00700="1~è…¾è®¯æ§è‚¡~00700~...";
                const match = text.match(/v_\w+="([^"]*)"/);
                if (match && match[1]) {
                    const parts = match[1].split('~');
                    if (parts.length > 30) {
                        // è…¾è®¯æ•°æ®æ ¼å¼: 
                        // parts[1]=åç§°, parts[2]=ä»£ç , parts[3]=å½“å‰ä»·, parts[4]=æ˜¨æ”¶, parts[5]=ä»Šå¼€
                        // parts[6]=æˆäº¤é‡, parts[7]=å¤–ç›˜, parts[8]=å†…ç›˜
                        // parts[9]=ä¹°ä¸€ä»·, parts[10]=ä¹°ä¸€é‡, parts[11]=ä¹°äºŒä»·...
                        // parts[33]=æœ€é«˜ä»·, parts[34]=æœ€ä½ä»·
                        // parts[35]=æœ€è¿‘é€ç¬”æˆäº¤, parts[36]=æ—¶é—´, parts[37]=æ¶¨è·Œé¢
                        // parts[38]=æ¶¨è·Œå¹…, parts[39]=å¸‚ç›ˆç‡, parts[40]=å¸‚å€¼
                        
                        const price = parseFloat(parts[3]);
                        const prevClose = parseFloat(parts[4]);
                        const change = price - prevClose;
                        const changePercent = prevClose > 0 ? (change / prevClose) * 100 : 0;
                        
                        return {
                            name: stock.name,
                            code: stock.symbol,
                            price: price,
                            change: change,
                            changePercent: changePercent,
                            open: parseFloat(parts[5]) || prevClose,
                            high: parseFloat(parts[33]) || price,
                            low: parseFloat(parts[34]) || price,
                            prevClose: prevClose,
                            volume: parseInt(parts[6]) || 0,
                            market: stock.market
                        };
                    }
                }
            } catch (error) {
                console.error(`Error fetching ${stock.code}:`, error);
            }
            return null;
        }
        
        // ç”ŸæˆSparkline SVG
        function generateSparkline(isUp) {
            // ç”Ÿæˆéšæœºèµ°åŠ¿æ•°æ®
            const points = [];
            let value = 50;
            for (let i = 0; i < 20; i++) {
                value += (Math.random() - 0.5) * 20;
                value = Math.max(10, Math.min(90, value));
                points.push(value);
            }
            
            // è®¡ç®—SVGè·¯å¾„
            const min = Math.min(...points);
            const max = Math.max(...points);
            const range = max - min || 1;
            
            const svgPoints = points.map((p, i) => {
                const x = (i / (points.length - 1)) * 100;
                const y = 100 - ((p - min) / range) * 80 - 10;
                return `${x},${y}`;
            }).join(' ');
            
            const color = isUp ? '#ff4d4f' : '#52c41a';
            
            return `
                <svg viewBox="0 0 100 100" preserveAspectRatio="none">
                    <polyline fill="none" stroke="${color}" stroke-width="2" points="${svgPoints}"/>
                    <circle cx="100" cy="${100 - ((points[points.length-1] - min) / range) * 80 - 10}" r="3" fill="${color}"/>
                </svg>
            `;
        }
        
        // æ¸²æŸ“è‚¡ç¥¨å¡ç‰‡
        function renderStockCard(data) {
            if (!data) return '';
            
            const isUp = data.changePercent >= 0;
            const changeSymbol = isUp ? '+' : '';
            const priceClass = isUp ? 'up' : 'down';
            
            // è®¡ç®—æ¶¨è·Œé¢
            const changeAmount = data.prevClose ? (data.price - data.prevClose) : 0;
            
            // ç”Ÿæˆè¿·ä½ èµ°åŠ¿å›¾
            const sparklineSvg = generateSparkline(isUp);
            
            return `
                <div class="stock-card ${priceClass}">
                    <div class="stock-header">
                        <div class="stock-info">
                            <h3>${data.name}</h3>
                            <div class="stock-code">${data.code}</div>
                        </div>
                        <div class="stock-price">
                            <div class="price ${priceClass}">${data.price.toFixed(2)}</div>
                            <div class="change ${priceClass}">
                                ${changeSymbol}${data.changePercent.toFixed(2)}%
                            </div>
                        </div>
                    </div>
                    <div class="stock-details">
                        <div class="detail-item">
                            <div class="detail-label">ä»Šå¼€</div>
                            <div class="detail-value">${data.open ? data.open.toFixed(2) : '--'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">æœ€é«˜</div>
                            <div class="detail-value">${data.high ? data.high.toFixed(2) : '--'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">æœ€ä½</div>
                            <div class="detail-value">${data.low ? data.low.toFixed(2) : '--'}</div>
                        </div>
                    </div>
                    <div class="sparkline">${sparklineSvg}</div>
                </div>
            `;
        }
        
        // åŠ è½½æ‰€æœ‰è‚¡ç¥¨æ•°æ®
        async function loadStockData() {
            const container = document.getElementById('stockList');
            container.innerHTML = '<div class="loading">æ­£åœ¨åŠ è½½è‚¡ç¥¨æ•°æ®...</div>';
            
            try {
                const results = await Promise.all(stocks.map(fetchStockData));
                const validData = results.filter(d => d !== null);
                
                if (validData.length > 0) {
                    // åˆ†ç»„æ˜¾ç¤ºï¼šAè‚¡ã€æ¸¯è‚¡å’Œç¾è‚¡
                    const cnStocks = validData.filter(s => s.market === 'cn');
                    const hkStocks = validData.filter(s => s.market === 'hk');
                    const usStocks = validData.filter(s => s.market === 'us');
                    
                    let html = '';
                    
                    // Aè‚¡éƒ¨åˆ†
                    if (cnStocks.length > 0) {
                        html += '<div class="stock-section"><h2 class="section-title cn">ğŸ‡¨ğŸ‡³ Aè‚¡</h2><div class="stock-grid">';
                        html += cnStocks.map(renderStockCard).join('');
                        html += '</div></div>';
                    }
                    
                    // æ¸¯è‚¡éƒ¨åˆ†
                    if (hkStocks.length > 0) {
                        html += '<div class="stock-section"><h2 class="section-title hk">ğŸ‡­ğŸ‡° æ¸¯è‚¡</h2><div class="stock-grid">';
                        html += hkStocks.map(renderStockCard).join('');
                        html += '</div></div>';
                    }
                    
                    // ç¾è‚¡éƒ¨åˆ†
                    if (usStocks.length > 0) {
                        html += '<div class="stock-section"><h2 class="section-title us">ğŸ‡ºğŸ‡¸ ç¾è‚¡</h2><div class="stock-grid">';
                        html += usStocks.map(renderStockCard).join('');
                        html += '</div></div>';
                    }
                    
                    container.innerHTML = html;
                    document.getElementById('updateTime').textContent = new Date().toLocaleString('zh-CN');
                } else {
                    container.innerHTML = '<div class="error">æ— æ³•è·å–è‚¡ç¥¨æ•°æ®ï¼Œè¯·ç¨åé‡è¯•</div>';
                }
            } catch (error) {
                console.error('Error loading stocks:', error);
                container.innerHTML = '<div class="error">åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥</div>';
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è·å–æ•°æ®
        loadStockData();
        
        // æ¯30ç§’åˆ·æ–°ä¸€æ¬¡
        setInterval(loadStockData, 30000);
        
        // Record visit for this page
        fetch('/api/visit', { 
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ page: window.location.pathname })
        }).catch(() => {});
    </script>
</body>
</html>